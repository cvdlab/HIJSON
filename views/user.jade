extends main

block internal_content
	script.
		var map = C3D.map2D;
		var socket = io('/users');
		
		var userIcon =  L.icon({
			iconUrl: 'assets/img/user.png',
			iconSize: [64, 64],
			iconAnchor:[32, 64]
		});
		
		var marker = L.marker(new L.LatLng(0, 0), {
		    icon: userIcon,
		    draggable: true
		});
		marker.addTo(map);		
		marker.bindPopup('<b>[' + marker.getLatLng().lat + '; ' + marker.getLatLng().lng + ']</b>');
		socket.emit('updatePosition', marker.getLatLng());
		
		marker.on('dragend', dragMarker);

		function dragMarker(e) {
			var latlng = marker.getLatLng();
			socket.emit('updatePosition', latlng);
			map.removeLayer(marker);
			marker.setLatLng(latlng);	
			marker.bindPopup('<b>[' + latlng.lat + '; ' + latlng.lng + ']</b>');
			map.addLayer(marker);
		}
