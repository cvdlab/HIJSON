extends layout

block head
	// Style
	link(rel='stylesheet', href='/assets/css/bootstrap.min.css')
	if enable_2D
		include ./includes/css_2d.jade
	if enable_3D
		include ./includes/css_3d.jade

block content
	.container-fluid
		// Default JavaScript libraries
		script(src='/assets/js/jquery-2.1.1.js')
		script(src='/assets/js/async.js')
		script(src='/assets/js/bootstrap.min.js')
		script(src='/socket.io/socket.io.js')
		
		include ./includes/js_libraries_2d.jade
		
		include ./includes/js_libraries_3d.jade
		
		
		
		script.
			var C3D = JSON.parse('!{C3D_server}');
		
		// C3D Library
		script(src='/libs/c3d_client.js')
		
		.page-header
			h1= title
		.row
			if (enable_2D && enable_3D)	
				.col-md-6
					h3 2D
					#container2D 
				.col-md-6
					h3 3D
					#container3D
						#pointer
						#plerror
			else if (enable_2D && !enable_3D)	
				.col-md-8.col-md-offset-2
					h3 2D
					#container2D 	
			else if (!enable_2D && enable_3D)
				.col-md-8.col-md-offset-2
					h3 3D
					#container3D
						#pointer
						#plerror

		if enable_2D
			script.
				C3D.init2D();
				C3D.generate2DModel();
				
		if enable_3D 
			script.
				C3D.init3D();
				C3D.generate3DModel();
		
		.page-header
			h1 Controls
		
		h3 Building Controls
		.row
			.col-md-3
				.lead Select Level: 
					select#selectLevel
			.col-md-3
				.lead Select Room:
					select#selectRoom(disabled = true)
					
		if enable_3D
			h3 3D Controls			
			.row
				.col-md-12
					button.btn.btn-default.btn-lg(id="startFPV") Start FPV
					
		script.
			var elements = ['level','building'];
			for(id in C3D.index)
				if(elements.indexOf(C3D.index[id].properties.class) > -1)
					$("#selectLevel").append('<option value=' + id + '>' + id +'</option>');
			
			$("#selectLevel").val(C3D.config.startPosition.levelId);
	
			$( "#selectLevel" ).on('change', function() {
				C3D.emit('selectFeature',this.value);
				
				// in aggiunta viene popolato il secondo men√π con le room
				$("#selectRoom").prop('disabled', false);
				$('#selectRoom option').each( function () { $(this).remove(); } );
				for(id in C3D.index)
					if( (C3D.index[id].properties.parent === this.value) && (C3D.index[id].properties.class === 'room') )
						$("#selectRoom").append('<option value=' + id + '>' + id +'</option>');
			});
	
			$( "#selectRoom" ).on('change', function() {
				C3D.emit('selectFeature', this.value);
			});

			$( "#startFPV" ).on('click', function() {
				C3D.emit('startFPV');
			});
		block internal_content